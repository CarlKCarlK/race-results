<!DOCTYPE html>
<html>

<head>
  <title>Race Results</title>
  <style>
    textarea {
      width: 100%;
    }

    button {
      margin-top: 10px;
    }
  </style>
</head>

<body data-server-no-reload>
  <h1>Race Results</h1>
  <label for="members">Members, can load from </label>
  <input type="file" id="membersFile" accept=".txt" onchange="loadMembersFromFile()">
  <textarea id="members" rows="4"></textarea>
  <p></p>
  <label for="results">Results</label>
  <textarea id="results" rows="8"></textarea>
  <button onclick="callWasmFunction()">Match with City</button>
  <button onclick="callWasmFunction()">Match w/o City</button>
  <p></p>
  <label for="matches">Matches</label>
  <textarea id="matches" readonly rows="10"></textarea>
  <script type="module">
    import init, { member_match, sample_members, sample_results } from './pkg/web1.js';

    function loadMembersFromFile() {
      var fileInput = document.getElementById('membersFile');
      var file = fileInput.files[0];
      if (file) {
        var reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('members').value = e.target.result;
        }
        reader.readAsText(file);
      }
    }

    function callWasmFunction() {
      var members = document.getElementById('members').value;
      var results = document.getElementById('results').value;
      // cmk add logic for the two buttons
      var wasmOutput = member_match(members, results, false);
      document.getElementById('matches').value = wasmOutput;
    };
    window.callWasmFunction = callWasmFunction;
    window.loadMembersFromFile = loadMembersFromFile;
    init().then(() => {
    document.getElementById('members').value = sample_members();
    document.getElementById('results').value = sample_results();
  });
  </script>
</body>

</html>
